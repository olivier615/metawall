"use strict";(self["webpackChunkposts_wall"]=self["webpackChunkposts_wall"]||[]).push([[312],{5312:function(t,i,e){e.r(i),e.d(i,{default:function(){return _t}});var s=e(6252),o=e(3577),r=e(9963);const n={class:"col-md-7"},a={class:"mb-3"},l={class:"card border-2 border-dark cus-border-radio cus-shadow-bottom"},d={class:"card-body p-4"},c={class:"d-flex mb-3 justify-content-between"},p={class:"d-flex"},m=["src"],g={class:"ms-3 d-flex flex-column"},u={class:"card-title mb-0 fw-bold name-link"},h={class:"cus-fs-sm text-secondary"},b={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},_=(0,s._)("div",{class:"btn-group",role:"group"},[(0,s._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,s._)("i",{class:"bi bi-three-dots fs-4"})]),(0,s._)("ul",{class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},[(0,s._)("li",null,[(0,s._)("a",{class:"dropdown-item"},"編輯貼文")]),(0,s._)("li",null,[(0,s._)("a",{class:"dropdown-item",href:"#"},"刪除貼文")])])],-1),f=[_],w={class:"card-text fw-bold"},k=["src"],y={class:"d-flex align-items-center mb-3"},v=(0,s._)("span",{class:"bi bi-hand-thumbs-up-fill fs-5"},null,-1),x=[v],$=(0,s._)("span",{class:"bi bi-hand-thumbs-up fs-5"},null,-1),C=[$],D={key:2,class:"spinner-border spinner-border-sm text-primary ms-2",role:"status"},L={key:3},T={class:"d-flex mb-2"},U=["src"],I={class:"mb-2 w-100"},P={class:"input-group mb-1"},S=(0,s.Uk)(" 留言 "),Z={key:0,class:"spinner-border spinner-border-sm",role:"status"},q={class:"input-group"},z={class:"link-pointer"},B=(0,s._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),M={key:0,class:"spinner-border spinner-border-sm text-primary ms-2",role:"status"},j=["src"],A={class:"d-flex mb-3"},G=["src"],N={class:"ms-3 d-flex flex-column"},W={class:"d-flex justify-content-between"},F={class:"d-flex flex-column"},H={class:"cus-fs-sm text-secondary mb-1"},J={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},K={class:"btn-group",role:"group"},O=(0,s._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,s._)("i",{class:"bi bi-three-dots fs-6"})],-1),V={class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},Y=["onClick"],E=["onClick"],Q={key:0},R={class:"mb-2 w-100"},X={class:"input-group mb-1"},tt=["onClick"],it=(0,s.Uk)(" 儲存 "),et={key:0,class:"spinner-border spinner-border-sm",role:"status"},st={class:"input-group"},ot={class:"link-pointer"},rt=["onChange"],nt=(0,s._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),at={key:0,class:"spinner-border spinner-border-sm text-primary ms-2",role:"status"},lt=["src"],dt={key:1},ct={class:"card-text fw-bold"},pt=["src"];function mt(t,i,e,_,v,$){const mt=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("ul",null,[(0,s._)("li",a,[(0,s._)("div",l,[(0,s._)("div",d,[(0,s._)("div",c,[(0,s._)("div",p,[(0,s._)("img",{src:v.post.user?.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"45px",width:"45px"}},null,8,m),(0,s._)("div",g,[(0,s._)("a",u,(0,o.zw)(v.post.user.name),1),(0,s._)("span",h,(0,o.zw)(new Date(v.post.createdAt).toLocaleString()),1)])]),v.post.user._id===v.userData._id?((0,s.wg)(),(0,s.iD)("div",b,f)):(0,s.kq)("",!0)]),(0,s._)("p",w,(0,o.zw)(v.post.content),1),v.post.image?((0,s.wg)(),(0,s.iD)("img",{key:0,src:v.post.image,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"postImage",style:{width:"100%"}},null,8,k)):(0,s.kq)("",!0),(0,s._)("div",y,[v.post.likes?.includes(v.userData._id)?((0,s.wg)(),(0,s.iD)("a",{key:0,href:"#",class:"me-1",onClick:i[0]||(i[0]=(0,r.iM)((t=>$.dislikePost(v.post)),["prevent"]))},x)):((0,s.wg)(),(0,s.iD)("a",{key:1,href:"#",class:"me-1",onClick:i[1]||(i[1]=(0,r.iM)((t=>$.likePost(v.post)),["prevent"]))},C)),v.isLoading?((0,s.wg)(),(0,s.iD)("div",D)):((0,s.wg)(),(0,s.iD)("span",L,(0,o.zw)(v.post.likes?.length),1))]),(0,s._)("div",T,[(0,s._)("img",{src:v.userData.photo,alt:"userAvatar",class:"me-2 img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,U),(0,s._)("div",I,[(0,s._)("div",P,[(0,s._)("input",{type:"text",ref:`post${v.post._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言..."},null,512),(0,s._)("button",{class:"px-2 px-md-6 btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:i[2]||(i[2]=t=>$.createNewComment(v.post))},[S,v.isLoading?((0,s.wg)(),(0,s.iD)("div",Z)):(0,s.kq)("",!0)])]),(0,s._)("div",q,[(0,s._)("label",z,[(0,s._)("input",{ref:`upload_img${v.post._id}`,style:{display:"none"},type:"file",onChange:i[3]||(i[3]=t=>$.uploadImage(v.post))},null,544),B,v.isLoading?((0,s.wg)(),(0,s.iD)("div",M)):(0,s.kq)("",!0),v.imgUrl&&v.commentingPost===v.post._id?((0,s.wg)(),(0,s.iD)("a",{key:1,href:"#",onClick:i[4]||(i[4]=(0,r.iM)((t=>v.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,s.kq)("",!0)])]),v.imgUrl&&v.commentingPost===v.post._id?((0,s.wg)(),(0,s.iD)("img",{key:0,src:v.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,j)):(0,s.kq)("",!0)])]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(v.post.comments,(t=>((0,s.wg)(),(0,s.iD)("div",{class:"p-3 mb-3 bg-light cus-border-radio",key:t._id},[(0,s._)("div",A,[(0,s._)("img",{src:t.user.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,G),(0,s._)("div",N,[(0,s._)("div",W,[(0,s._)("div",F,[(0,s.Wm)(mt,{href:"#",class:"card-title mb-0 fw-bold name-link",to:`/personalWall/${t.user._id}`},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(t.user.name),1)])),_:2},1032,["to"]),(0,s._)("span",H,(0,o.zw)(new Date(t.createdAt).toLocaleString()),1)]),v.userData._id===t.user._id?((0,s.wg)(),(0,s.iD)("div",J,[(0,s._)("div",K,[O,(0,s._)("ul",V,[(0,s._)("li",null,[(0,s._)("a",{onClick:(0,r.iM)((i=>$.openComment(t)),["prevent"]),class:"dropdown-item"},"編輯留言",8,Y)]),(0,s._)("li",null,[(0,s._)("a",{onClick:(0,r.iM)((i=>$.deleteComment(t._id)),["prevent"]),class:"dropdown-item",href:"#"},"刪除留言",8,E)])])])])):(0,s.kq)("",!0)]),t._id===v.editIngComment?((0,s.wg)(),(0,s.iD)("div",Q,[(0,s._)("div",R,[(0,s._)("div",X,[(0,s.wy)((0,s._)("input",{type:"text",ref_for:!0,ref:`comment${t._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言...","onUpdate:modelValue":i[5]||(i[5]=t=>v.editingText=t)},null,512),[[r.nr,v.editingText]]),(0,s._)("button",{class:"btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:i=>$.editComment(t)},[it,v.isLoading?((0,s.wg)(),(0,s.iD)("div",et)):(0,s.kq)("",!0)],8,tt)]),(0,s._)("div",st,[(0,s._)("label",ot,[(0,s._)("input",{ref_for:!0,ref:`upload_img${t._id}`,style:{display:"none"},type:"file",onChange:i=>$.uploadImage(t)},null,40,rt),nt,v.isLoading?((0,s.wg)(),(0,s.iD)("div",at)):(0,s.kq)("",!0),v.imgUrl&&v.editIngComment===t._id?((0,s.wg)(),(0,s.iD)("a",{key:1,href:"#",onClick:i[6]||(i[6]=(0,r.iM)((t=>v.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,s.kq)("",!0)])]),v.imgUrl&&v.editIngComment===t._id?((0,s.wg)(),(0,s.iD)("img",{key:0,src:v.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,lt)):(0,s.kq)("",!0)])])):((0,s.wg)(),(0,s.iD)("div",dt,[(0,s._)("p",ct,(0,o.zw)(t.comment),1),t.image?((0,s.wg)(),(0,s.iD)("img",{key:0,src:t.image,class:"cus-border-radio img-fluid border border-2 border-dark",alt:"postImage",style:{width:"100%"}},null,8,pt)):(0,s.kq)("",!0)]))])])])))),128))])])])])])}var gt=e(4902),ut={data(){return{isLoading:!1,url:"https://fathomless-earth-71463.herokuapp.com/api",post:{user:{}},postsTomeSort:"最新貼文",q:"",fileInput:null,imgUrl:"",commentingPost:"",editIngComment:"",editingText:"",userData:{},popConfirmCard:this.$swal.mixin({showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"確定刪除",cancelButtonText:"取消"})}},methods:{deleteComment(t){this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t}/comment`).then((()=>{this.getSinglePost();const t={icon:"success",title:"已刪除留言"};gt.Z.emit("popToast",t)})).catch((()=>{const t={icon:"error",title:"刪除留言失敗，請刷新後重試"};gt.Z.emit("popToast",t),this.isLoading=!1}))},openComment(t){this.isLoading=!1,this.editIngComment=t._id,this.imgUrl=t.image,this.editingText=t.comment},editComment(t){this.isLoading=!0;const i=this.$refs[`comment${t._id}`][0].value;if(""===i.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return gt.Z.emit("popToast",t),void(this.isLoading=!1)}const e={comment:this.editingText,image:this.imgUrl};this.$http.patch(`${this.url}/posts/${t._id}/comment`,e).then((()=>{this.getSinglePost();const t={icon:"success",title:"編輯留言成功"};gt.Z.emit("popToast",t),this.editIngComment="",this.imgUrl="",this.editingText=""})).catch((()=>{this.isLoading=!1}))},deletePost(t){this.popConfirmCard.fire({title:"確定刪除貼文?",text:"貼文刪除後將無法恢復",icon:"warning"}).then((i=>{this.isLoading=!0,i.isConfirmed&&this.$http.delete(`${this.url}/posts/${t}`).then((()=>{this.getSinglePost();const t={icon:"success",title:"貼文已刪除"};gt.Z.emit("popToast",t),this.isLoading=!1}))}))},getSinglePost(){this.isLoading=!0;const{id:t}=this.$route.params;this.$http.get(`${this.url}/posts/${t}`).then((t=>{this.post=t.data.data,this.isLoading=!1})).catch((()=>{document.cookie="MetaWall=;",localStorage.userData&&localStorage.removeItem("userData");const t={icon:"error",title:"無法取得貼文，請重新登入"};gt.Z.emit("popToast",t),this.isLoading=!1,this.$router.push("/login/sign_in")}))},createNewComment(t){this.isLoading=!0;const i=this.$refs[`post${t._id}`].value;if(""===i.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return gt.Z.emit("popToast",t),void(this.isLoading=!1)}const e={comment:i,image:this.imgUrl};this.$http.post(`${this.url}/posts/${t._id}/comment`,e).then((i=>{this.imgUrl="",this.getSinglePost();const e={icon:"success",title:"已新增留言"};gt.Z.emit("popToast",e),this.$refs[`post${t._id}`].value=""})).catch((()=>{const t={icon:"error",title:"新增留言失敗，請刷新後重試"};gt.Z.emit("popToast",t),this.isLoading=!1}))},likePost(t){this.isLoading=!0,this.$http.post(`${this.url}/posts/${t._id}/likes`).then((()=>{this.getSinglePost()})).catch((()=>{const t={icon:"error",title:"留言點讚失敗"};gt.Z.emit("popToast",t),this.isLoading=!1}))},dislikePost(t){this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t._id}/dislikes`).then((()=>{this.getSinglePost()})).catch((()=>{const t={icon:"error",title:"取消留言點讚失敗"};gt.Z.emit("popToast",t),this.isLoading=!1}))},uploadImage(t){this.isLoading=!0,this.commentingPost=t._id,this.fileInput=this.$refs[`upload_img${t._id}`];const i=this.fileInput[0].files[0];if(!i){const t={icon:"warning",title:"未選擇圖片檔案"};return gt.Z.emit("popToast",t),void(this.isLoading=!1)}if("image/jpeg"!==i.type&&"image/png"!==i.type&&"image/jpg"!==i.type&&"image/gif"!==i.type){const t={icon:"warning",title:"檔案類別僅限 jpg, jpeg, png 或 gif"};return gt.Z.emit("popToast",t),void(this.isLoading=!1)}if(i.size>2097152){const t={icon:"warning",title:"上傳檔案須小於 2 MB"};return gt.Z.emit("popToast",t),void(this.isLoading=!1)}const e=new FormData;e.append("image",i),this.$http.post(`${this.url}/upload`,e).then((t=>{this.imgUrl=t.data.imgUrl,this.isLoading=!1})).catch((t=>{const i={icon:"error",title:t.response.data.message};gt.Z.emit("popToast",i),this.isLoading=!1}))}},mounted(){localStorage.userData&&(this.userData=JSON.parse(localStorage.userData)),this.getSinglePost()}},ht=e(3744);const bt=(0,ht.Z)(ut,[["render",mt]]);var _t=bt}}]);
//# sourceMappingURL=312.f3ec078b.js.map