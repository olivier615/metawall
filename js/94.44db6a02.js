"use strict";(self["webpackChunkposts_wall"]=self["webpackChunkposts_wall"]||[]).push([[94],{8094:function(t,s,e){e.r(s),e.d(s,{default:function(){return Kt}});e(6699);var i=e(6252),o=e(3577),r=e(9963);const a={class:"col-md-7"},n={class:"border border-2 border-dark position-relative bg-white mb-3 cus-border-radio"},l={class:"d-flex justify-content-between"},d={class:"d-flex"},c=["src"],p={class:"d-flex flex-column justify-content-center"},m={class:"mb-0 fw-bolder"},u={class:"mb-0"},g={key:0,class:"d-flex justify-content-center align-items-center me-3"},h={key:0,class:"spinner-border spinner-border-sm text-primary me-2",role:"status"},b=(0,i._)("div",{class:"position-absolute border border-2 border-dark bg-white cus-border-radio",style:{height:"80px",width:"100%","z-index":"-1",top:"6px",left:"-6px"}},null,-1),w={class:"row"},f={class:"col-md-4"},_=(0,i._)("option",{selected:"",value:"最新貼文"},"最新貼文",-1),k=(0,i._)("option",{value:"由舊到新"},"由舊到新",-1),y=[_,k],v={class:"col-md-8"},x={class:"input-group mb-3"},D={key:0,class:"spinner-border spinner-border-sm",role:"status"},$={key:1,class:"bi bi-search fs-6"},C={key:0,class:"mb-3"},L={class:"card border-2 border-dark cus-border-radio cus-shadow-bottom"},P=(0,i.uE)('<div class="px-3 py-2 border-bottom border-2 border-dark"><div class="d-flex my-1"><div class="cus-dot cus-dot-bg-pink"></div><div class="cus-dot cus-dot-bg-yellow"></div><div class="cus-dot cus-dot-bg-green"></div></div></div>',1),T={class:"card-body p-4"},U={class:"d-flex align-items-center justify-content-center"},Z={class:"card-title text-secondary"},q={class:"card border-2 border-dark cus-border-radio cus-shadow-bottom"},I={class:"card-body p-4"},z={class:"d-flex mb-3 justify-content-between"},M={class:"d-flex"},S=["src"],j={class:"ms-3 d-flex flex-column"},F={class:"cus-fs-sm text-secondary"},B={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},A={class:"btn-group",role:"group"},W=(0,i._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,i._)("i",{class:"bi bi-three-dots fs-4"})],-1),G={class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},N=(0,i.Uk)("編輯貼文"),V=["onClick"],E={class:"card-text fw-bold"},H=["src"],K={class:"d-flex align-items-center mb-3"},Y=["onClick"],J=(0,i._)("span",{class:"bi bi-hand-thumbs-up-fill fs-5"},null,-1),O=[J],Q=["onClick"],R=(0,i._)("span",{class:"bi bi-hand-thumbs-up fs-5"},null,-1),X=[R],tt={key:2,class:"spinner-border spinner-border-sm text-primary",role:"status"},st={key:3},et={class:"d-flex mb-2"},it=["src"],ot={class:"mb-2 w-100"},rt={class:"input-group mb-1"},at=["onClick"],nt=(0,i.Uk)(" 留言 "),lt={key:0,class:"spinner-border spinner-border-sm ms-2",role:"status"},dt={class:"input-group"},ct={class:"link-pointer"},pt=["onChange"],mt=(0,i._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),ut={key:0,class:"spinner-border spinner-border-sm text-primary ms-2",role:"status"},gt=["src"],ht={class:"d-flex mb-3"},bt=["src"],wt={class:"ms-3 d-flex flex-column"},ft={class:"d-flex justify-content-between"},_t={class:"d-flex flex-column"},kt={class:"cus-fs-sm text-secondary mb-1"},yt={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},vt={class:"btn-group",role:"group"},xt=(0,i._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,i._)("i",{class:"bi bi-three-dots fs-6"})],-1),Dt={class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},$t=["onClick"],Ct=["onClick"],Lt={key:0},Pt={class:"mb-2 w-100"},Tt={class:"input-group mb-1"},Ut=["onClick"],Zt=(0,i.Uk)(" 儲存 "),qt={key:0,class:"spinner-border spinner-border-sm ms-2",role:"status"},It={class:"input-group"},zt={class:"link-pointer"},Mt=["onChange"],St=(0,i._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),jt={key:0,class:"spinner-border spinner-border-sm text-primary ms-2",role:"status"},Ft=["src"],Bt={key:1},At={class:"card-text fw-bold"},Wt=["src"];function Gt(t,s,e,_,k,J){const R=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)("div",a,[(0,i._)("div",n,[(0,i._)("div",l,[(0,i._)("div",d,[(0,i._)("img",{src:k.personalData.photo,class:"img-fluid rounded-start border-end border-2 border-dark me-3",alt:"userAvatar",style:{height:"80px",width:"80px"}},null,8,c),(0,i._)("div",p,[(0,i._)("h5",m,(0,o.zw)(k.personalData.name),1),(0,i._)("p",u,(0,o.zw)(k.personalData.followers?.length||0)+" 人追蹤",1)])]),k.personalData._id!==k.userData._id?((0,i.wg)(),(0,i.iD)("div",g,[k.isLoading?((0,i.wg)(),(0,i.iD)("div",h)):(0,i.kq)("",!0),k.following?((0,i.wg)(),(0,i.iD)("button",{key:1,type:"button",class:"btn cus-unFollow-btn border-2 fw-bolder cus-border-radio cus-shadow-border",style:{height:"36px",width:"96px"},onClick:s[0]||(s[0]=(...t)=>J.unFollowUser&&J.unFollowUser(...t))}," 取消追蹤 ")):((0,i.wg)(),(0,i.iD)("button",{key:2,type:"button",class:"btn btn-blue-dark border-2 fw-bolder cus-border-radio cus-shadow-border",style:{height:"36px",width:"96px"},onClick:s[1]||(s[1]=(...t)=>J.followUser&&J.followUser(...t))}," 追蹤 "))])):(0,i.kq)("",!0)]),b]),(0,i._)("div",w,[(0,i._)("div",f,[(0,i.wy)((0,i._)("select",{name:"timeSort",class:"py-2 form-select no-border-radius border-2 border-dark text-dark","onUpdate:modelValue":s[2]||(s[2]=t=>k.postsTomeSort=t)},y,512),[[r.bM,k.postsTomeSort]])]),(0,i._)("div",v,[(0,i._)("div",x,[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>k.q=t),class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"搜尋貼文"},null,512),[[r.nr,k.q]]),(0,i._)("button",{class:"btn btn-primary no-border-radius border-2 border-dark",type:"button",id:"button-addon2",onClick:s[4]||(s[4]=(0,r.iM)(((...t)=>J.searchPosts&&J.searchPosts(...t)),["prevent"]))},[k.isLoading?((0,i.wg)(),(0,i.iD)("div",D)):((0,i.wg)(),(0,i.iD)("span",$))])])])]),(0,i._)("ul",null,[0===k.personalPost.length?((0,i.wg)(),(0,i.iD)("li",C,[(0,i._)("div",L,[P,(0,i._)("div",T,[(0,i._)("div",U,[(0,i._)("p",Z," 目前尚無動態，快邀請 "+(0,o.zw)(k.personalData.name)+" 新增一則貼文吧！ ",1)])])])])):(0,i.kq)("",!0)]),(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(k.personalPost,(e=>((0,i.wg)(),(0,i.iD)("li",{class:"mb-3",key:e._id},[(0,i._)("div",q,[(0,i._)("div",I,[(0,i._)("div",z,[(0,i._)("div",M,[(0,i._)("img",{src:e.user.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"45px",width:"45px"}},null,8,S),(0,i._)("div",j,[(0,i._)("a",{href:"#",onClick:s[5]||(s[5]=(0,r.iM)((s=>J.changeParams(t.comment.user._id)),["prevent"])),class:"card-title mb-0 fw-bold name-link"},(0,o.zw)(e.user.name),1),(0,i._)("span",F,(0,o.zw)(new Date(e.createdAt).toLocaleString()),1)])]),k.userData._id===e.user._id?((0,i.wg)(),(0,i.iD)("div",B,[(0,i._)("div",A,[W,(0,i._)("ul",G,[(0,i._)("li",null,[(0,i.Wm)(R,{to:`/editPost/${e._id}`,class:"dropdown-item"},{default:(0,i.w5)((()=>[N])),_:2},1032,["to"])]),(0,i._)("li",null,[(0,i._)("a",{onClick:(0,r.iM)((t=>J.deletePost(e._id)),["prevent"]),class:"dropdown-item",href:"#"},"刪除貼文",8,V)])])])])):(0,i.kq)("",!0)]),(0,i._)("p",E,(0,o.zw)(e.content),1),e.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.image,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"postImage",style:{width:"100%"}},null,8,H)):(0,i.kq)("",!0),(0,i._)("div",K,[e.likes.includes(k.userData._id)?((0,i.wg)(),(0,i.iD)("a",{key:0,href:"#",class:"me-1",onClick:(0,r.iM)((t=>J.dislikePost(e)),["prevent"])},O,8,Y)):((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",class:"me-1",onClick:(0,r.iM)((t=>J.likePost(e)),["prevent"])},X,8,Q)),k.isLoading?((0,i.wg)(),(0,i.iD)("div",tt)):((0,i.wg)(),(0,i.iD)("span",st,(0,o.zw)(e.likes.length),1))]),(0,i._)("div",et,[(0,i._)("img",{src:k.userData.photo,alt:"userAvatar",class:"me-2 img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,it),(0,i._)("div",ot,[(0,i._)("div",rt,[(0,i._)("input",{type:"text",ref_for:!0,ref:`post${e._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言..."},null,512),(0,i._)("button",{class:"px-2 px-md-6 btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:t=>J.createNewComment(e)},[nt,k.isLoading?((0,i.wg)(),(0,i.iD)("div",lt)):(0,i.kq)("",!0)],8,at)]),(0,i._)("div",dt,[(0,i._)("label",ct,[(0,i._)("input",{ref_for:!0,ref:`upload_img${e._id}`,style:{display:"none"},type:"file",onChange:t=>J.uploadImage(e)},null,40,pt),mt,k.isLoading?((0,i.wg)(),(0,i.iD)("div",ut)):(0,i.kq)("",!0),k.imgUrl&&k.commentingPost===e._id?((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",onClick:s[6]||(s[6]=(0,r.iM)((t=>k.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,i.kq)("",!0)])]),k.imgUrl&&k.commentingPost===e._id?((0,i.wg)(),(0,i.iD)("img",{key:0,src:k.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,gt)):(0,i.kq)("",!0)])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.comments,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"p-3 mb-3 bg-light cus-border-radio",key:t._id},[(0,i._)("div",ht,[(0,i._)("img",{src:t.user.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,bt),(0,i._)("div",wt,[(0,i._)("div",ft,[(0,i._)("div",_t,[(0,i.Wm)(R,{href:"#",class:"card-title mb-0 fw-bold name-link",to:`/personalWall/${t.user._id}`},{default:(0,i.w5)((()=>[(0,i.Uk)((0,o.zw)(t.user.name),1)])),_:2},1032,["to"]),(0,i._)("span",kt,(0,o.zw)(new Date(t.createdAt).toLocaleString()),1)]),k.userData._id===t.user._id?((0,i.wg)(),(0,i.iD)("div",yt,[(0,i._)("div",vt,[xt,(0,i._)("ul",Dt,[(0,i._)("li",null,[(0,i._)("a",{onClick:(0,r.iM)((s=>J.openComment(t)),["prevent"]),class:"dropdown-item"},"編輯留言",8,$t)]),(0,i._)("li",null,[(0,i._)("a",{onClick:(0,r.iM)((s=>J.deleteComment(t._id)),["prevent"]),class:"dropdown-item",href:"#"},"刪除留言",8,Ct)])])])])):(0,i.kq)("",!0)]),t._id===k.editIngComment?((0,i.wg)(),(0,i.iD)("div",Lt,[(0,i._)("div",Pt,[(0,i._)("div",Tt,[(0,i.wy)((0,i._)("input",{type:"text",ref_for:!0,ref:`comment${t._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言...","onUpdate:modelValue":s[7]||(s[7]=t=>k.editingText=t)},null,512),[[r.nr,k.editingText]]),(0,i._)("button",{class:"btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:s=>J.editComment(t)},[Zt,k.isLoading?((0,i.wg)(),(0,i.iD)("div",qt)):(0,i.kq)("",!0)],8,Ut)]),(0,i._)("div",It,[(0,i._)("label",zt,[(0,i._)("input",{ref_for:!0,ref:`upload_img${t._id}`,style:{display:"none"},type:"file",onChange:s=>J.uploadImage(t)},null,40,Mt),St,k.isLoading?((0,i.wg)(),(0,i.iD)("div",jt)):(0,i.kq)("",!0),k.imgUrl&&k.editIngComment===t._id?((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",onClick:s[8]||(s[8]=(0,r.iM)((t=>k.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,i.kq)("",!0)])]),k.imgUrl&&k.editIngComment===t._id?((0,i.wg)(),(0,i.iD)("img",{key:0,src:k.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,Ft)):(0,i.kq)("",!0)])])):((0,i.wg)(),(0,i.iD)("div",Bt,[(0,i._)("p",At,(0,o.zw)(t.comment),1),t.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:t.image,class:"cus-border-radio img-fluid border border-2 border-dark",alt:"postImage",style:{width:"100%"}},null,8,Wt)):(0,i.kq)("",!0)]))])])])))),128))])])])))),128))])])}var Nt=e(4902),Vt={data(){return{isLoading:!1,url:"https://fathomless-earth-71463.herokuapp.com/api",personalData:{},personalPost:[],userData:{},following:!1,postsTomeSort:"最新貼文",q:"",fileInput:null,imgUrl:"",commentingPost:"",editIngComment:"",editingText:"",popConfirmCard:this.$swal.mixin({showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"確定刪除",cancelButtonText:"取消"})}},methods:{deleteComment(t){this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t}/comment`).then((()=>{this.getPersonalPosts();const t={icon:"success",title:"已刪除留言"};Nt.Z.emit("popToast",t)})).catch((()=>{const t={icon:"error",title:"刪除留言失敗，請刷新後重試"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},openComment(t){this.isLoading=!1,this.editIngComment=t._id,this.imgUrl=t.image,this.editingText=t.comment},editComment(t){this.isLoading=!0;const s=this.$refs[`comment${t._id}`][0].value;if(""===s.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return Nt.Z.emit("popToast",t),void(this.isLoading=!1)}const e={comment:this.editingText,image:this.imgUrl};this.$http.patch(`${this.url}/posts/${t._id}/comment`,e).then((()=>{this.getPersonalPosts();const t={icon:"success",title:"編輯留言成功"};Nt.Z.emit("popToast",t),this.editIngComment="",this.imgUrl="",this.editingText=""})).catch((()=>{this.isLoading=!1}))},deletePost(t){this.popConfirmCard.fire({title:"確定刪除貼文?",text:"貼文刪除後將無法恢復",icon:"warning"}).then((s=>{s.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t}`).then((()=>{this.getPersonalPosts();const t={icon:"success",title:"貼文已刪除"};this.isLoading=!1,Nt.Z.emit("popToast",t)})))}))},getPersonalPosts(){this.isLoading=!0;const{id:t}=this.$route.params;this.$http.get(`${this.url}/posts/user/${t}`).then((t=>{this.personalData=t.data.userData,this.personalPost=t.data.posts,this.following=!1,this.checkFollow(),this.isLoading=!1})).catch((()=>{const t={icon:"error",title:"無法取得使用者資料"};Nt.Z.emit("popToast",t),this.isLoading=!1,this.$router.push("/postWall")}))},changeParams(t){this.isLoading=!0,this.$router.push(`/personalWall/${t}`),this.$http.get(`${this.url}/posts/user/${t}`).then((t=>{this.personalData=t.data.userData,this.personalPost=t.data.posts,this.following=!1,this.checkFollow(),this.isLoading=!1})).catch((()=>{const t={icon:"error",title:"無法取得使用者資料"};Nt.Z.emit("popToast",t),this.isLoading=!1,this.$router.push("/postWall")}))},searchPosts(){this.isLoading=!0;const t="由舊到新"===this.postsTomeSort?"&timeSort=asc":"";this.$http.get(`${this.url}/posts/user/${this.personalData._id}?q=${this.q}${t}`).then((t=>{this.personalPost=t.data.posts,this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},createNewComment(t){this.isLoading=!0;const s=this.$refs[`post${t._id}`][0].value;if(""===s.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return Nt.Z.emit("popToast",t),void(this.isLoading=!1)}const e={comment:s,image:this.imgUrl};this.$http.post(`${this.url}/posts/${t._id}/comment`,e).then((()=>{this.imgUrl="",this.getPersonalPosts();const s={icon:"success",title:"已新增留言"};Nt.Z.emit("popToast",s),this.$refs[`post${t._id}`][0].value=""})).catch((()=>{const t={icon:"error",title:"新增留言失敗，請刷新後重試"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},likePost(t){this.isLoading=!0,this.$http.post(`${this.url}/posts/${t._id}/likes`).then((()=>{this.getPersonalPosts()})).catch((()=>{const t={icon:"error",title:"留言點讚失敗"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},dislikePost(t){this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t._id}/dislikes`).then((()=>{this.getPersonalPosts()})).catch((()=>{const t={icon:"error",title:"取消留言點讚失敗"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},followUser(){this.isLoading=!0;const{id:t}=this.$route.params;this.$http.post(`${this.url}/users/${t}/follow`).then((t=>{this.getPersonalPosts();const s={icon:"success",title:t.data.message};Nt.Z.emit("popToast",s),this.isLoading=!1})).catch((()=>{const t={icon:"error",title:"加入追蹤失敗，請刷新後重試"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},unFollowUser(){this.isLoading=!0;const{id:t}=this.$route.params;this.$http.delete(`${this.url}/users/${t}/unFollow`).then((t=>{this.getPersonalPosts();const s={icon:"success",title:t.data.message};Nt.Z.emit("popToast",s),this.isLoading=!1})).catch((()=>{const t={icon:"error",title:"取消追蹤失敗，請刷新後重試"};Nt.Z.emit("popToast",t),this.isLoading=!1}))},checkFollow(){this.personalData.followers.forEach((t=>{t.user===this.userData._id&&(this.following=!0)}))},uploadImage(t){this.isLoading=!0,this.commentingPost=t._id,this.fileInput=this.$refs[`upload_img${t._id}`];const s=this.fileInput[0].files[0];if(!s){const t={icon:"warning",title:"未選擇圖片檔案"};return Nt.Z.emit("popToast",t),void(this.isLoading=!1)}if("image/jpeg"!==s.type&&"image/png"!==s.type&&"image/jpg"!==s.type&&"image/gif"!==s.type){const t={icon:"warning",title:"檔案類別僅限 jpg, jpeg, png 或 gif"};return Nt.Z.emit("popToast",t),void(this.isLoading=!1)}if(s.size>2097152){const t={icon:"warning",title:"上傳檔案須小於 2 MB"};return Nt.Z.emit("popToast",t),void(this.isLoading=!1)}const e=new FormData;e.append("image",s),this.$http.post(`${this.url}/upload`,e).then((t=>{this.imgUrl=t.data.imgUrl,this.isLoading=!1})).catch((t=>{const s={icon:"error",title:t.response.data.message};Nt.Z.emit("popToast",s),this.isLoading=!1}))}},mounted(){localStorage.userData&&(this.userData=JSON.parse(localStorage.userData)),this.getPersonalPosts()}},Et=e(3744);const Ht=(0,Et.Z)(Vt,[["render",Gt]]);var Kt=Ht}}]);
//# sourceMappingURL=94.44db6a02.js.map