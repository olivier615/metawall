"use strict";(self["webpackChunkposts_wall"]=self["webpackChunkposts_wall"]||[]).push([[884],{3884:function(t,s,e){e.r(s),e.d(s,{default:function(){return Kt}});e(6699);var i=e(6252),o=e(9963),r=e(3577);const a={class:"col-md-7"},n={class:"row"},d={class:"col-md-4"},l=(0,i._)("option",{selected:"",value:"最新貼文"},"最新貼文",-1),c=(0,i._)("option",{value:"由舊到新"},"由舊到新",-1),p=[l,c],m={class:"col-md-8"},u={class:"input-group mb-3"},g=["disabled"],b={key:0,class:"d-flex justify-content-center"},h=(0,i._)("div",{class:"spinner-border spinner-border-sm",role:"status"},[(0,i._)("span",{class:"visually-hidden"},"Loading...")],-1),_=[h],f={key:1,class:"bi bi-search fs-6"},k={key:0},w={class:"mb-3"},y={class:"card border-2 border-dark cus-border-radio cus-shadow-bottom"},v=(0,i.uE)('<div class="px-3 py-2 border-bottom border-2 border-dark"><div class="d-flex my-1"><div class="cus-dot cus-dot-bg-pink"></div><div class="cus-dot cus-dot-bg-yellow"></div><div class="cus-dot cus-dot-bg-green"></div></div></div>',1),x={class:"card-body p-4"},D={class:"d-flex align-items-center justify-content-center"},C={key:0,class:"d-flex justify-content-center"},$=(0,i._)("div",{class:"spinner-border",role:"status"},[(0,i._)("span",{class:"visually-hidden"},"Loading...")],-1),L=[$],T={key:1,class:"card-title text-secondary"},U={key:1},P={class:"card border-2 border-dark cus-border-radio cus-shadow-bottom"},q={class:"card-body p-4"},I={class:"d-flex mb-3 justify-content-between"},Z={class:"d-flex"},S=["src"],M={class:"ms-3 d-flex flex-column"},j={class:"cus-fs-sm text-secondary"},z={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},B={class:"btn-group",role:"group"},W=(0,i._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,i._)("i",{class:"bi bi-three-dots fs-4"})],-1),A={class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},G=(0,i.Uk)("編輯貼文"),N=["onClick"],V={class:"card-text fw-bold"},H=["src"],K={class:"d-flex align-items-center mb-3"},Y=["onClick"],E=(0,i._)("span",{class:"bi bi-hand-thumbs-up-fill fs-5"},null,-1),F=[E],J=["onClick"],O=(0,i._)("span",{class:"bi bi-hand-thumbs-up fs-5"},null,-1),Q=[O],R={key:2,class:"spinner-border spinner-border-sm text-primary",role:"status"},X={key:3},tt={class:"d-flex mb-2"},st=["src"],et={class:"mb-2 w-100"},it={class:"input-group mb-1"},ot=["disabled","onClick"],rt=(0,i.Uk)(" 留言 "),at={key:0,class:"spinner-border spinner-border-sm",role:"status"},nt={class:"input-group"},dt={class:"link-pointer"},lt=["onChange"],ct=(0,i._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),pt={key:0,class:"spinner-border text-primary spinner-border-sm",role:"status"},mt=["src"],ut={class:"d-flex mb-3"},gt=["src"],bt={class:"ms-3 d-flex flex-column"},ht={class:"d-flex justify-content-between"},_t={class:"d-flex flex-column"},ft={class:"cus-fs-sm text-secondary mb-1"},kt={key:0,class:"btn-group",role:"group","aria-label":"Button group with nested dropdown"},wt={class:"btn-group",role:"group"},yt=(0,i._)("button",{id:"btnGroupDrop1",type:"button",class:"btn btn dropdown-toggle text-primary","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,i._)("i",{class:"bi bi-three-dots fs-6"})],-1),vt={class:"dropdown-menu","aria-labelledby":"btnGroupDrop1"},xt=["onClick"],Dt=["onClick"],Ct={key:0},$t={class:"mb-2 w-100"},Lt={class:"input-group mb-1"},Tt=["onClick"],Ut=(0,i.Uk)(" 儲存 "),Pt={key:0,class:"spinner-border spinner-border-sm",role:"status"},qt={class:"input-group"},It={class:"link-pointer"},Zt=["onChange"],St=(0,i._)("span",{class:"bi bi-card-image fs-5 text-primary ms-1"},null,-1),Mt={key:0,class:"spinner-border spinner-border-sm test-primary",role:"status"},jt=["src"],zt={key:1},Bt={class:"card-text fw-bold"},Wt=["src"];function At(t,s,e,l,c,h){const $=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)("div",a,[(0,i._)("div",n,[(0,i._)("div",d,[(0,i.wy)((0,i._)("select",{name:"timeSort",class:"py-2 form-select no-border-radius border-2 border-dark text-dark","onUpdate:modelValue":s[0]||(s[0]=t=>c.postsTomeSort=t)},p,512),[[o.bM,c.postsTomeSort]])]),(0,i._)("div",m,[(0,i._)("div",u,[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=t=>c.q=t),class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"搜尋貼文"},null,512),[[o.nr,c.q]]),(0,i._)("button",{disabled:c.isLoading,class:"btn btn-primary no-border-radius border-2 border-dark",type:"button",id:"button-addon2",onClick:s[2]||(s[2]=(0,o.iM)(((...t)=>h.searchPosts&&h.searchPosts(...t)),["prevent"]))},[c.isLoading?((0,i.wg)(),(0,i.iD)("div",b,_)):((0,i.wg)(),(0,i.iD)("span",f))],8,g)])])]),0===c.posts.length?((0,i.wg)(),(0,i.iD)("ul",k,[(0,i._)("li",w,[(0,i._)("div",y,[v,(0,i._)("div",x,[(0,i._)("div",D,[c.isLoading?((0,i.wg)(),(0,i.iD)("div",C,L)):((0,i.wg)(),(0,i.iD)("p",T,"目前尚無動態，新增一則貼文吧！"))])])])])])):((0,i.wg)(),(0,i.iD)("ul",U,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.posts,(t=>((0,i.wg)(),(0,i.iD)("li",{class:"mb-3",key:t._id},[(0,i._)("div",P,[(0,i._)("div",q,[(0,i._)("div",I,[(0,i._)("div",Z,[(0,i._)("img",{src:t.user.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"45px",width:"45px"}},null,8,S),(0,i._)("div",M,[(0,i.Wm)($,{class:"card-title mb-0 fw-bold name-link",to:`/personalWall/${t.user._id}`},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t.user.name),1)])),_:2},1032,["to"]),(0,i._)("span",j,(0,r.zw)(new Date(t.createdAt).toLocaleString()),1)])]),c.userData._id===t.user._id?((0,i.wg)(),(0,i.iD)("div",z,[(0,i._)("div",B,[W,(0,i._)("ul",A,[(0,i._)("li",null,[(0,i.Wm)($,{to:`/editPost/${t._id}`,class:"dropdown-item"},{default:(0,i.w5)((()=>[G])),_:2},1032,["to"])]),(0,i._)("li",null,[(0,i._)("a",{onClick:(0,o.iM)((s=>h.deletePost(t._id)),["prevent"]),class:"dropdown-item",href:"#"},"刪除貼文",8,N)])])])])):(0,i.kq)("",!0)]),(0,i._)("p",V,(0,r.zw)(t.content),1),t.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:t.image,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"postImage",style:{width:"100%"}},null,8,H)):(0,i.kq)("",!0),(0,i._)("div",K,[t.likes.includes(c.userData._id)?((0,i.wg)(),(0,i.iD)("a",{key:0,href:"#",class:"me-1",onClick:(0,o.iM)((s=>h.dislikePost(t)),["prevent"])},F,8,Y)):((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",class:"me-1",onClick:(0,o.iM)((s=>h.likePost(t)),["prevent"])},Q,8,J)),c.isLoading?((0,i.wg)(),(0,i.iD)("div",R)):((0,i.wg)(),(0,i.iD)("span",X,(0,r.zw)(t.likes.length),1))]),(0,i._)("div",tt,[(0,i._)("img",{src:c.userData.photo,alt:"userAvatar",class:"me-2 img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,st),(0,i._)("div",et,[(0,i._)("div",it,[(0,i._)("input",{type:"text",ref_for:!0,ref:`post${t._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言..."},null,512),(0,i._)("button",{disabled:c.isLoading,class:"px-2 px-md-6 btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:s=>h.createNewComment(t)},[rt,c.isLoading?((0,i.wg)(),(0,i.iD)("div",at)):(0,i.kq)("",!0)],8,ot)]),(0,i._)("div",nt,[(0,i._)("label",dt,[(0,i._)("input",{ref_for:!0,ref:`upload_img${t._id}`,style:{display:"none"},type:"file",onChange:s=>h.uploadImage(t)},null,40,lt),ct,c.isLoading?((0,i.wg)(),(0,i.iD)("div",pt)):(0,i.kq)("",!0),c.imgUrl&&c.commentingPost===t._id?((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",onClick:s[3]||(s[3]=(0,o.iM)((t=>c.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,i.kq)("",!0)])]),c.imgUrl&&c.commentingPost===t._id?((0,i.wg)(),(0,i.iD)("img",{key:0,src:c.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,mt)):(0,i.kq)("",!0)])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.comments,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"p-3 mb-3 bg-light cus-border-radio",key:t._id},[(0,i._)("div",ut,[(0,i._)("img",{src:t.user.photo,alt:"userAvatar",class:"img-fluid border border-dark border-3 rounded-circle",style:{height:"40px",width:"40px"}},null,8,gt),(0,i._)("div",bt,[(0,i._)("div",ht,[(0,i._)("div",_t,[(0,i.Wm)($,{href:"#",class:"card-title mb-0 fw-bold name-link",to:`/personalWall/${t.user._id}`},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t.user.name),1)])),_:2},1032,["to"]),(0,i._)("span",ft,(0,r.zw)(new Date(t.createdAt).toLocaleString()),1)]),c.userData._id===t.user._id?((0,i.wg)(),(0,i.iD)("div",kt,[(0,i._)("div",wt,[yt,(0,i._)("ul",vt,[(0,i._)("li",null,[(0,i._)("a",{onClick:(0,o.iM)((s=>h.openComment(t)),["prevent"]),class:"dropdown-item"},"編輯留言",8,xt)]),(0,i._)("li",null,[(0,i._)("a",{onClick:(0,o.iM)((s=>h.deleteComment(t._id)),["prevent"]),class:"dropdown-item",href:"#"},"刪除留言",8,Dt)])])])])):(0,i.kq)("",!0)]),t._id===c.editIngComment?((0,i.wg)(),(0,i.iD)("div",Ct,[(0,i._)("div",$t,[(0,i._)("div",Lt,[(0,i.wy)((0,i._)("input",{type:"text",ref_for:!0,ref:`comment${t._id}`,class:"py-2 form-control no-border-radius border-2 border-dark",placeholder:"留言...","onUpdate:modelValue":s[4]||(s[4]=t=>c.editingText=t)},null,512),[[o.nr,c.editingText]]),(0,i._)("button",{class:"btn btn-primary no-border-radius border-2 border-dark btn-blue-dark cus-none-shadow-border",type:"button",onClick:s=>h.editComment(t)},[Ut,c.isLoading?((0,i.wg)(),(0,i.iD)("span",Pt)):(0,i.kq)("",!0)],8,Tt)]),(0,i._)("div",qt,[(0,i._)("label",It,[(0,i._)("input",{ref_for:!0,ref:`upload_img${t._id}`,style:{display:"none"},type:"file",onChange:s=>h.uploadImage(t)},null,40,Zt),St,c.isLoading?((0,i.wg)(),(0,i.iD)("div",Mt)):(0,i.kq)("",!0),c.imgUrl&&c.editIngComment===t._id?((0,i.wg)(),(0,i.iD)("a",{key:1,href:"#",onClick:s[5]||(s[5]=(0,o.iM)((t=>c.imgUrl=""),["prevent"])),class:"ms-2"},"刪除圖片")):(0,i.kq)("",!0)])]),c.imgUrl&&c.editIngComment===t._id?((0,i.wg)(),(0,i.iD)("img",{key:0,src:c.imgUrl,class:"cus-border-radio img-fluid border border-2 border-dark mb-3",alt:"commentImage",style:{width:"100%"}},null,8,jt)):(0,i.kq)("",!0)])])):((0,i.wg)(),(0,i.iD)("div",zt,[(0,i._)("p",Bt,(0,r.zw)(t.comment),1),t.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:t.image,class:"cus-border-radio img-fluid border border-2 border-dark",alt:"postImage",style:{width:"100%"}},null,8,Wt)):(0,i.kq)("",!0)]))])])])))),128))])])])))),128))]))])}var Gt=e(4902),Nt={data(){return{isLoading:!1,url:"https://fathomless-earth-71463.herokuapp.com/api",posts:[],postsTomeSort:"最新貼文",q:"",userData:{},fileInput:null,imgUrl:"",commentingPost:"",editIngComment:"",editingText:"",popConfirmCard:this.$swal.mixin({showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"確定刪除",cancelButtonText:"取消"})}},methods:{openComment(t){this.isLoading=!1,this.editIngComment=t._id,this.imgUrl=t.image,this.editingText=t.comment},editComment(t){const s=this.$refs[`comment${t._id}`][0].value;if(""===s.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return void Gt.Z.emit("popToast",t)}const e={comment:this.editingText,image:this.imgUrl};this.$http.patch(`${this.url}/posts/${t._id}/comment`,e).then((()=>{this.getPosts();const t={icon:"success",title:"編輯留言成功"};Gt.Z.emit("popToast",t),this.editIngComment="",this.imgUrl="",this.editingText=""}))},deletePost(t){this.popConfirmCard.fire({title:"確定刪除貼文?",text:"貼文刪除後將無法恢復",icon:"warning"}).then((s=>{this.isLoading=!0,s.isConfirmed&&this.$http.delete(`${this.url}/posts/${t}`).then((()=>{this.getPosts();const t={icon:"success",title:"貼文已刪除"};Gt.Z.emit("popToast",t),this.isLoading=!1}))}))},getPosts(){this.isLoading=!0,this.$http.get(`${this.url}/posts`).then((t=>{this.posts=t.data.data,this.isLoading=!1})).catch((()=>{document.cookie="MetaWall=;",localStorage.userData&&localStorage.removeItem("userData");const t={icon:"error",title:"無法取得貼文，請重新登入"};this.isLoading=!1,Gt.Z.emit("popToast",t),this.$router.push("/login/sign_in")}))},searchPosts(){this.isLoading=!0;const t="由舊到新"===this.postsTomeSort?"&timeSort=asc":"";this.$http.get(`${this.url}/posts?q=${this.q}${t}`).then((t=>{this.posts=t.data.data,this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},createNewComment(t){this.isLoading=!0;const s=this.$refs[`post${t._id}`][0].value;if(""===s.trim()){const t={icon:"warning",title:"留言內容不能為空白"};return Gt.Z.emit("popToast",t),void(this.isLoading=!1)}const e={comment:s,image:this.imgUrl};this.$http.post(`${this.url}/posts/${t._id}/comment`,e).then((s=>{this.imgUrl="",this.getPosts();const e={icon:"success",title:"已新增留言"};Gt.Z.emit("popToast",e),this.$refs[`post${t._id}`][0].value=""})).catch((()=>{const t={icon:"error",title:"新增留言失敗，請刷新後重試"};Gt.Z.emit("popToast",t),this.isLoading=!1}))},likePost(t){this.isLoading=!0,this.$http.post(`${this.url}/posts/${t._id}/likes`).then((()=>{this.getPosts()})).catch((()=>{const t={icon:"error",title:"留言點讚失敗"};Gt.Z.emit("popToast",t),this.isLoading=!1}))},dislikePost(t){this.isLoading=!0,this.$http.delete(`${this.url}/posts/${t._id}/dislikes`).then((()=>{this.getPosts()})).catch((()=>{const t={icon:"error",title:"取消留言點讚失敗"};Gt.Z.emit("popToast",t),this.isLoading=!1}))},deleteComment(t){this.$http.delete(`${this.url}/posts/${t}/comment`).then((()=>{this.getPosts();const t={icon:"success",title:"已刪除留言"};Gt.Z.emit("popToast",t)})).catch((()=>{const t={icon:"error",title:"刪除留言失敗，請刷新後重試"};Gt.Z.emit("popToast",t)}))},uploadImage(t){this.isLoading=!0,this.commentingPost=t._id,this.fileInput=this.$refs[`upload_img${t._id}`];const s=this.fileInput[0].files[0];if(!s){const t={icon:"warning",title:"未選擇圖片檔案"};return Gt.Z.emit("popToast",t),void(this.isLoading=!1)}if("image/jpeg"!==s.type&&"image/png"!==s.type&&"image/jpg"!==s.type&&"image/gif"!==s.type){const t={icon:"warning",title:"檔案類別僅限 jpg, jpeg, png 或 gif"};return Gt.Z.emit("popToast",t),void(this.isLoading=!1)}if(s.size>2097152){const t={icon:"warning",title:"上傳檔案須小於 2 MB"};return Gt.Z.emit("popToast",t),void(this.isLoading=!1)}const e=new FormData;e.append("image",s),this.$http.post(`${this.url}/upload`,e).then((t=>{this.imgUrl=t.data.imgUrl,this.isLoading=!1})).catch((t=>{const s={icon:"error",title:t.response.data.message};Gt.Z.emit("popToast",s),this.isLoading=!1}))}},mounted(){localStorage.userData&&(this.userData=JSON.parse(localStorage.userData)),this.getPosts()}},Vt=e(3744);const Ht=(0,Vt.Z)(Nt,[["render",At]]);var Kt=Ht}}]);
//# sourceMappingURL=884.e761a94d.js.map